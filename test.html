<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>Google 지도 위치 검색 데모</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        html, body { height: 100%; margin: 0; }
        #map { height: 100%; }
        .controls {
            position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
            background: #fff; border-radius: 12px; padding: 8px; box-shadow: 0 2px 10px rgba(0,0,0,.15);
            display: flex; gap: 8px; align-items: center; z-index: 5;
        }
        #pac-input {
            width: 320px; padding: 10px 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 14px;
        }
        button {
            padding: 10px 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;
        }
    </style>
</head>
<body>
<div class="controls">
    <input id="pac-input" type="text" placeholder="장소 검색 (예: 영남대학교, 서울역)" />
    <button id="locate-btn">내 위치</button>
</div>
<div id="map"></div>

<script>
    let map, marker, infoWindow, autocomplete;

    function initMap() {
        // 초기 중심(서울 시청 근처)
        map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 37.5665, lng: 126.9780 },
            zoom: 13,
            mapId: "DEMO_MAP_ID" // 선택사항: 스타일 맵 ID 있으면 넣으세요
        });

        marker = new google.maps.Marker({
            map,
            visible: false
        });

        infoWindow = new google.maps.InfoWindow();

        // Places Autocomplete
        const input = document.getElementById("pac-input");
        autocomplete = new google.maps.places.Autocomplete(input, {
            fields: ["geometry", "formatted_address", "name", "place_id"],
            // types: ["geocode"], // 주소 위주로 제한하려면 주석 해제
        });
        autocomplete.bindTo("bounds", map);

        autocomplete.addListener("place_changed", () => {
            infoWindow.close();
            marker.setVisible(false);

            const place = autocomplete.getPlace();
            if (!place.geometry || !place.geometry.location) {
                alert("선택한 장소에 좌표 정보가 없습니다. 다른 검색어를 입력해 주세요.");
                return;
            }

            // 지도 이동/확대
            if (place.geometry.viewport) {
                map.fitBounds(place.geometry.viewport);
            } else {
                map.setCenter(place.geometry.location);
                map.setZoom(17);
            }

            // 마커 & InfoWindow
            marker.setPosition(place.geometry.location);
            marker.setVisible(true);

            const content = `
          <div style="min-width:220px">
            <strong>${place.name ?? "선택한 장소"}</strong><br/>
            <div>${place.formatted_address ?? ""}</div>
            <div style="margin-top:6px;font-size:12px;color:#666">Place ID: ${place.place_id ?? "-"}</div>
          </div>
        `;
            infoWindow.setContent(content);
            infoWindow.open(map, marker);
        });

        // "내 위치" 버튼 (브라우저 권한 필요)
        document.getElementById("locate-btn").addEventListener("click", () => {
            if (!navigator.geolocation) {
                alert("이 브라우저는 위치 정보를 지원하지 않습니다.");
                return;
            }
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    const loc = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                    map.setCenter(loc);
                    map.setZoom(16);
                    marker.setPosition(loc);
                    marker.setVisible(true);
                    infoWindow.setContent("<div>현재 위치</div>");
                    infoWindow.open(map, marker);
                },
                (err) => {
                    console.error(err);
                    alert("내 위치를 가져오지 못했습니다. 브라우저 권한을 확인해 주세요.");
                },
                { enableHighAccuracy: true, timeout: 10000 }
            );
        });
    }
</script>

<!-- ✅ YOUR_API_KEY 를 본인 키로 교체하세요.
     한국어/한국 지역 고정: language=ko&region=KR -->
<script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBdxKYNR_nT9lS75aRoVxMM9BQ_IBbG5eU&libraries=places&language=ko&region=KR&callback=initMap"
        async defer></script>
</body>
</html>
